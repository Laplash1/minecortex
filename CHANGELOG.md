# MineCortex 変更履歴

## v1.4.3 - 2025-01-23

### 新機能
#### マルチプレイヤー同期開始システム
- **全員ログイン待機機能**: 個別ログイン後即開始から全員ログイン完了後の同期開始に変更
- **同期開始設定**: `MultiPlayerCoordinator.configureSyncStart(expectedPlayersCount, enabled)`で制御
- **準備完了報告**: 各AIが準備完了を報告し、全員揃うまで待機する仕組み
- **タイムアウト機能**: 5分待機後は強制開始（デッドロック防止）
- **リアルタイム進捗表示**: "⏳ 他のプレイヤーを待機中 (2/5人)" 形式で待機状況を表示

#### 技術改善
- **非同期初期化**: `MinecraftAI.initialize()`を非同期メソッドに変更
- **待機ログ**: 2秒間隔で他プレイヤーの参加状況をリアルタイム表示
- **全員通知**: 全プレイヤー準備完了時に"🎉 全5人の準備完了！"メッセージを配信

### 変更されたファイル

#### src/MultiPlayerCoordinator.js
**変更内容**: 同期開始機能を追加
**変更意図**: マルチプレイヤー環境で全員のログイン完了を待ってからタスクを開始するため
**期待効果**: 協調的なゲームプレイの実現とリソース競合の最小化

#### src/MinecraftAI.js  
**変更内容**: initialize()メソッドを非同期化し、同期開始待機機能を追加
**変更意図**: 全プレイヤーの準備完了まで待機してからAIタスクを開始するため
**期待効果**: 同期的な多人数ゲームプレイの実現

#### examples/multiple-players.js
**変更内容**: 同期開始設定の追加とspawnイベントの非同期化
**変更意図**: マルチプレイヤー起動時に期待プレイヤー数を設定し、同期開始を有効化するため
**期待効果**: 統制の取れたチームプレイの実現

## 使用方法

```bash
# 従来通り（同期開始有効）
npm run multi-players

# 設定ファイル使用（同期開始有効）
npm run config-squad

# 同期開始を無効にしたい場合は、コード内で
# coordinator.configureSyncStart(expectedPlayersCount, false)
```

## 動作フロー

1. **ボット起動**: 各ボットが順次ログイン
2. **準備報告**: ログイン完了したボットが`reportPlayerReady()`を呼び出し
3. **待機状態**: 他のボットの準備完了を待機（進捗表示）
4. **全員準備完了**: 最後のボットが準備完了すると全員に通知
5. **タスク開始**: 同期的にAIタスクを開始

## 前バージョンとの互換性

- 単一ボット実行時は従来通り即座に開始
- 既存の環境変数設定は引き続き有効
- MultiPlayerCoordinatorが無い場合は同期開始をスキップ