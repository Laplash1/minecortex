# MineCortex 変更履歴

## v1.4.5 - 2025-01-24

### アイテム採掘・回収システム改善
#### アイテム採掘後の取得問題修正
- **採掘後アイテム回収の確実性向上**: `collectDroppedItems`メソッドの全面的な改善
- **距離判定最適化**: アイテム検出範囲を8ブロック→5ブロックに調整、精度向上
- **移動精度改善**: pathfinder goal距離を1.5→1.0ブロックに変更、より確実な接近
- **回収検証システム**: アイテム実在確認によるfalse positive削減
- **インベントリ追跡**: 回収前後のアイテム数比較による実際の取得数確認

#### 作業台作成システム強化
- **作業台クラフトの確実性向上**: `CraftWorkbenchSkill`の詳細なデバッグ出力追加
- **素材チェック強化**: インベントリ詳細表示による材料確認の可視化
- **レシピ検出改善**: 複数の作業台名称（`crafting_table`, `workbench`）対応
- **クラフト後検証**: 作業台作成完了の確実な確認システム
- **エラーハンドリング強化**: 詳細なエラー情報とスタックトレース出力

#### InventoryUtilsの精度向上
- **アイテム検出柔軟性**: `hasItem`メソッドに柔軟マッチング機能追加
- **作業台検出改善**: 複数のアイテム名バリエーション対応
- **デバッグ支援機能**: `logInventoryDetails`メソッド追加で詳細インベントリ表示
- **パターン検索**: `findItemsByPattern`メソッドで部分一致検索機能
- **インベントリサマリー拡張**: 詳細アイテムリストと総数表示

### 変更されたファイル

#### src/SkillLibrary.js
**変更内容**: `collectDroppedItems`メソッドの全面的な改善、精度と確実性向上
**変更意図**: アイテム採掘後の取得失敗問題を解決し、回収成功率を大幅向上
**期待効果**: 採掘後アイテム取得成功率を約50%→90%以上に改善

#### src/SkillLibrary.js (CraftWorkbenchSkill)
**変更内容**: 作業台クラフト処理の詳細ログ出力とエラーハンドリング強化
**変更意図**: 作業台作成失敗の原因特定と確実なクラフト実行
**期待効果**: 作業台作成の成功率向上とデバッグの容易化

#### src/InventoryUtils.js
**変更内容**: `hasItem`の柔軟マッチング機能とデバッグ支援メソッド追加
**変更意図**: アイテム検出精度向上とトラブルシューティング支援
**期待効果**: インベントリ関連の問題解決とシステムの信頼性向上

## v1.4.4 - 2025-01-23

### コード品質改善
#### ESLintによる系統的リファクタリング
- **大幅なエラー削減**: 63件（エラー42件、警告21件）→ 12件（エラー0件、警告12件）
- **改善率**: 81%削減（critical errors 100%解決）
- **自動修正適用**: 41件の末尾スペース、演算子位置、改行問題を自動解決
- **未使用変数修正**: `MultiPlayerCoordinator.js`の未使用パラメータを適切に命名
- **可読性向上**: 長すぎる行を戦略的に分割し、変数による中間計算を導入

#### 技術的改善詳細
- **複雑な座標計算の簡潔化**: `offset変数`を使用した184文字行の分割
- **コメント分離**: 151文字のインラインコメントを適切に分離
- **変数による中間値**: 複雑な計算式を変数分割で可読性向上
- **プロトタイプ汚染対策**: ESLint推奨のセキュリティパターンを維持

### 変更されたファイル

#### src/MultiPlayerCoordinator.js
**変更内容**: 未使用パラメータ`playerId`を`_playerId`に修正、長い行を変数分割
**変更意図**: ESLint no-unused-vars ルール準拠とコード可読性向上
**期待効果**: コード品質向上と保守性強化

#### src/MinecraftAI.js
**変更内容**: 長いコメント行の分離、パフォーマンス計算ロジックの変数化
**変更意図**: 120文字制限遵守とコードの可読性向上
**期待効果**: デバッグとメンテナンスの効率化

#### src/SkillLibrary.js
**変更内容**: 複雑な座標計算を中間変数で分割、重複計算の削除
**変更意図**: 184文字の計算行を読みやすい形に分割
**期待効果**: ナビゲーション計算の理解しやすさ向上

#### examples/multiple-players.js, examples/advanced-multi-players.js
**変更内容**: 演算子位置の修正、末尾スペースの削除
**変更意図**: ESLint Standard設定への完全準拠
**期待効果**: 一貫したコーディングスタイルの確立

## 品質管理指標

### ESLint分析結果
- **修正前**: Critical errors 42件、Warnings 21件、Total 63件
- **修正後**: Critical errors 0件、Warnings 12件、Total 12件
- **解決されたエラータイプ**:
  - `no-trailing-spaces`: 38件解決
  - `operator-linebreak`: 3件解決
  - `no-unused-vars`: 1件解決
- **残存警告**: 主に`max-len`（12件）、影響度低

### 技術的負債削減
- **セキュリティ**: プロトタイプ汚染対策パターンを維持
- **パフォーマンス**: 重複計算の削除により効率向上
- **保守性**: 変数分割による理解しやすさ向上
- **一貫性**: 全ファイルでの統一コーディングスタイル確立

## v1.4.3 - 2025-01-23

### 新機能
#### マルチプレイヤー同期開始システム
- **全員ログイン待機機能**: 個別ログイン後即開始から全員ログイン完了後の同期開始に変更
- **同期開始設定**: `MultiPlayerCoordinator.configureSyncStart(expectedPlayersCount, enabled)`で制御
- **準備完了報告**: 各AIが準備完了を報告し、全員揃うまで待機する仕組み
- **タイムアウト機能**: 5分待機後は強制開始（デッドロック防止）
- **リアルタイム進捗表示**: "⏳ 他のプレイヤーを待機中 (2/5人)" 形式で待機状況を表示

#### 技術改善
- **非同期初期化**: `MinecraftAI.initialize()`を非同期メソッドに変更
- **待機ログ**: 2秒間隔で他プレイヤーの参加状況をリアルタイム表示
- **全員通知**: 全プレイヤー準備完了時に"🎉 全5人の準備完了！"メッセージを配信

### 変更されたファイル

#### src/MultiPlayerCoordinator.js
**変更内容**: 同期開始機能を追加
**変更意図**: マルチプレイヤー環境で全員のログイン完了を待ってからタスクを開始するため
**期待効果**: 協調的なゲームプレイの実現とリソース競合の最小化

#### src/MinecraftAI.js  
**変更内容**: initialize()メソッドを非同期化し、同期開始待機機能を追加
**変更意図**: 全プレイヤーの準備完了まで待機してからAIタスクを開始するため
**期待効果**: 同期的な多人数ゲームプレイの実現

#### examples/multiple-players.js
**変更内容**: 同期開始設定の追加とspawnイベントの非同期化
**変更意図**: マルチプレイヤー起動時に期待プレイヤー数を設定し、同期開始を有効化するため
**期待効果**: 統制の取れたチームプレイの実現

## 使用方法

```bash
# 従来通り（同期開始有効）
npm run multi-players

# 設定ファイル使用（同期開始有効）
npm run config-squad

# 同期開始を無効にしたい場合は、コード内で
# coordinator.configureSyncStart(expectedPlayersCount, false)
```

## 動作フロー

1. **ボット起動**: 各ボットが順次ログイン
2. **準備報告**: ログイン完了したボットが`reportPlayerReady()`を呼び出し
3. **待機状態**: 他のボットの準備完了を待機（進捗表示）
4. **全員準備完了**: 最後のボットが準備完了すると全員に通知
5. **タスク開始**: 同期的にAIタスクを開始

## 前バージョンとの互換性

- 単一ボット実行時は従来通り即座に開始
- 既存の環境変数設定は引き続き有効
- MultiPlayerCoordinatorが無い場合は同期開始をスキップ